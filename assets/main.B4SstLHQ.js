var E=(n=>(n[n.GameStart=0]="GameStart",n[n.GameLoop=1]="GameLoop",n[n.GameOver=2]="GameOver",n[n.GameFinished=3]="GameFinished",n))(E||{}),R=(n=>(n[n.Rectangle=0]="Rectangle",n[n.Ellipse=1]="Ellipse",n))(R||{}),P=(n=>(n[n.Massive=96]="Massive",n[n.Huge=72]="Huge",n[n.Large=48]="Large",n[n.Normal=32]="Normal",n))(P||{});class F{soundFile;played=!1;looping=!1;constructor(t,e){this.soundFile=t.loadSound(e)}play(){this.soundFile.play(),this.played=!0}loop(){this.soundFile.loop(),this.looping=!0}pause(){this.soundFile.pause(),this.looping=!1}stop(){this.soundFile.stop(),this.looping=!1}setVolume(t){this.soundFile.setVolume(t)}isPlaying(){return this.soundFile.isPlaying()}isLooping(){return this.looping}hasPlayed(){return this.played}initState(){this.stop(),this.played=!1,this.looping=!1}}const g={width:1280,height:720},T={minWidth:26,maxWidth:32,minHeight:160,maxHeight:190},O=g.width,b=120,k={size:50,acceleration:1,maxSpeed:8,frictionForce:.85,jumpForce:-18,gravity:.9,jumpRotationDuration:600},A=g.width/2,Y=g.height-b-k.size/2,N=40,V={chunk:8,size:400},nt=75,ot=.1,D={minStars:30,maxStars:45,patternCount:8},L={background:1,bigStarRays:4,bigStar:5,smallStars:8,sandDunes:50,ground:105,player:999,scoreUI:1025};class M{static circle=[];static triangle=[];static numPoints=60;static circlePoints(t){const e=[];for(let o=0;o<M.numPoints;o++){const i=Math.PI*2/M.numPoints*o-Math.PI;e.push({x:Math.cos(i)*t,y:Math.sin(i)*t})}M.circle=e}static trianglePoints(t,e){const o=[],i=[{x:-e*Math.sin(Math.PI/3),y:e*.5},{x:0,y:-e},{x:e*Math.sin(Math.PI/3),y:e*.5}],s=M.numPoints/3;for(let r=0;r<3;r++){const c=i[r],l=i[(r+1)%3];for(let u=0;u<s;u++){const m=u/s;o.push({x:t.lerp(c.x,l.x,m),y:t.lerp(c.y,l.y,m)})}}const a=M.numPoints/12;for(let r=0;r<a;r++)o.push(o.shift());M.triangle=o}static morphCircleTriangle(t,e){t.beginShape();for(let o=0;o<M.numPoints;o++){const i=t.lerp(M.circle[o].x,M.triangle[o].x,e),s=t.lerp(M.circle[o].y,M.triangle[o].y,e);t.vertex(i,s)}t.endShape(t.CLOSE)}static render(t,e,o,i,s){M.circlePoints(s.x/2),M.trianglePoints(t,s.x/2),t.push();const a=e.requireComponent(o,"Velocity").velocity,r=e.requireComponent(o,"Physics");if(t.translate(i.x,i.y),r.isGrounded){const c=13+Math.abs(a.x)*1.5;t.rectMode(t.CENTER),t.rect(0,0,s.x,s.y,c)}else{if(d.playerJumpRotationDirection!==0){const u=ut(d.playerJumpRotationProgress,.15),m=Math.PI*2,h=u*m*d.playerJumpRotationDirection;t.rotate(h)}const l=((u,m,h)=>1-Math.max(Math.min(Math.abs(u/-m),1),0)**h)(a.y,r.jumpForce,1.75);M.morphCircleTriangle(t,l)}t.pop()}}class J{static render(t,e,o,i,s){t.image(f.backgroundBuffer,0,0)}static preload(t){const e=t.createGraphics(g.width,g.height);e.noStroke();const o=e.color(17,56,85),i=e.color(107,161,199);for(let s=0;s<g.height;s++){const a=e.map(s,0,g.height,0,1);e.stroke(e.lerpColor(o,i,a)),e.line(0,s,g.width,s)}f.backgroundBuffer=e}}class G{static render(t,e,o,i,s){const a=e.requireComponent(o,"Cactus");let r=0;for(const{y:l,side:u}of a.parameters.armPositions){const m=a.parameters.flowers[r];G.drawArm(t,i,s,l,u,m),r++}t.rect(i.x,i.y,s.x,s.y,15,15,5,5);let c=f.cactusCache.get(o);c===void 0&&(c=G.createSpineMask(t,s),f.cactusCache.set(o,c)),t.push(),t.image(c.spinesImg,i.x,i.y),t.pop()}static preloadFlowerCache(t){const e=[8,9,10];for(const o of e){const i=o*2,s=i/2;let a=f.cactusFlowerCache.get(o);if(a===void 0){const r=t.createGraphics(i,i);r.noStroke(),r.fill(255,192,203),r.translate(s,s);for(let c=0;c<5;c++)r.push(),r.rotate(2*Math.PI*c/5),r.ellipse(o*.5,0,o,o*.6),r.pop();r.fill(255,255,0),r.ellipse(0,0,o*.5,o*.5),a=r,f.cactusFlowerCache.set(o,r)}}}static createSpineMask(t,e){const o=t.createGraphics(e.x,e.y),i=t.createGraphics(e.x,e.y);o.stroke("black"),o.strokeWeight(2.5);const s=Math.floor(e.x/5),a=Math.floor(e.y);for(let l=0;l<s;l++)for(let u=0;u<a;u++)o.point(l*(e.x/4),u*(e.y/40));i.rect(0,0,e.x,e.y,15,15,5,5);const r=o.get(),c=i.get();return r.mask(c),{spineBuf:o,maskBuf:i,spinesImg:r,maskImg:c}}static generateParameters(t){const e=[0,1,2],o=e[Math.floor(Math.random()*e.length)],i=[],s=g.height-b-t.y,a=s+110,r=s+140;for(let p=0;p<o;p++){const C=a+Math.floor(Math.random()*(r-a+1));if(i.length>0){const I=-1*i[0].side;i.push({y:C,side:I})}if(i.length===0){const I=[-1,1],S=I[Math.floor(Math.random()*I.length)];i.push({y:C,side:S})}}const c=1,l=2,u=25,m=75,h=[8,9,10],y=[];for(let p=0;p<o;p++){const C=[],I=c+Math.floor(Math.random()*(l-c+1));for(let S=0;S<I;S++){const q=(u+Math.floor(Math.random()*(m-u+1)))/100,z=h[Math.floor(Math.random()*2)];C.push({position:q,size:z})}y.push(C)}return{armPositions:i,flowers:y}}static drawArm(t,e,o,i,s,a){const r=e.x+o.x/2,c=o.x*1.5,l=o.y*.4,u=[{start:{x:r,y:i},cp1:{x:r,y:i},cp2:{x:r,y:i},end:{x:r,y:i-30+l/100}},{start:{x:r,y:i-30+l/100},cp1:{x:r+s*c,y:i-l/3},cp2:{x:r+s*c*.9,y:i-l*.9},end:{x:r+s*c,y:i-l*1.25}},{start:{x:r+s*c,y:i-l*1.25},cp1:{x:r+s*c,y:i-l*1.4},cp2:{x:r+s*c*1.5,y:i-l*1.4},end:{x:r+s*c*1.5,y:i-l*1.25}},{start:{x:r+s*c*1.5,y:i-l*1.25},cp1:{x:r+s*c*1.6,y:i-l/5},cp2:{x:r+s*c*1.1,y:i-l/5},end:{x:r,y:i}}];t.strokeWeight(0),t.beginShape(),t.vertex(r,i);for(const h of u)t.bezierVertex(h.cp1.x,h.cp1.y,h.cp2.x,h.cp2.y,h.end.x,h.end.y);t.endShape();const m=G.getFlowerPositions(t,e,o,i,s,a.map(h=>h.position));for(let h=0;h<m.length;h++){const y=m[h],p={x:y.x,y:y.y},C=a[h].size;G.drawFlower(t,p,C,y.rotation)}}static getFlowerPositions(t,e,o,i,s,a){const r=e.x+o.x/2,c=o.x*1.5,l=o.y*.4,u=[{x1:r,y1:i-30+1*(l/100),x2:r+s*c,y2:i-l/3,x3:r+s*c*.9,y3:i-l*.9,x4:r+s*c,y4:i-l*1.25},{x1:r+s*c,y1:i-l*1.25,x2:r+s*c,y2:i-l*1.4,x3:r+s*c*1.5,y3:i-l*1.4,x4:r+s*c*1.5,y4:i-l*1.25},{x1:r+s*c*1.5,y1:i-l*1.25,x2:r+s*c*1.6,y2:i-l/5,x3:r+s*c*1.1,y3:i-l/5,x4:r,y4:i}];t.shuffle(u);const m=[];for(let h=0;h<a.length;h++){const y=a[h],p=u[h%u.length],C=t.bezierPoint(p.x1,p.x2,p.x3,p.x4,y),I=t.bezierPoint(p.y1,p.y2,p.y3,p.y4,y),S=t.bezierTangent(p.x1,p.x2,p.x3,p.x4,y),q=t.bezierTangent(p.y1,p.y2,p.y3,p.y4,y),z=Math.atan2(q,S);m.push({x:C,y:I,rotation:z+(s>0?t.PI/2:-t.PI/2)})}return m}static drawFlower(t,e,o,i){const s=f.cactusFlowerCache.get(o);if(s===void 0)throw new Error("Flower should have been preloaded");t.push(),t.translate(e.x,e.y),t.rotate(i),t.image(s,-o,-o),t.pop()}}class H{static render(t,e,o,i,s){t.fill(25,20,80),t.rect(i.x,i.y,s.x,s.y);const a=e.requireComponent(o,"VoidZone").pattern,r=f.voidZoneStarCache[a];for(let c=0;c<r.length;c++){const l=r[c],u=l.size+t.sin(l.t)*2,m=i.x+l.x*s.x,h=i.y+l.y*s.y;t.noStroke(),t.fill(255),t.ellipse(m,h,u,u)}}static preloadStars(t){for(let e=0;e<D.patternCount;e++){const o=D.minStars+Math.floor(Math.random()*(D.maxStars-D.minStars)),i=H.createVoidZoneStars(t,o);f.voidZoneStarCache.push(i)}}static createVoidZoneStars(t,e){const o=[];for(let i=0;i<e;i++)o.push({x:t.random(.02,.98),y:t.random(.02,.98),size:t.random(.5,1.75),t:t.random(t.TAU)});return o}}function it(n,t,e,o,i,s){const l=B(n,o,i,5,s??0);n.drawingContext.filter="blur(0.25px)",K(n,l,o,2)}function st(n,t,e,o,i,s){const l=B(n,o,i,5,s??0);n.drawingContext.filter="blur(3px)",K(n,l,o,40)}function rt(n,t,e,o,i,s){const c=s??0,l=n.drawingContext.fillStyle,u=n.alpha(l),m=4;for(let y=m-1;y>=0;y--){const p=1+y*.4,C={x:i.x*p,y:i.y*p},I=u*(1-y/m)*.5,S=n.color(250,222,180);S.setAlpha(I),n.fill(S),n.noStroke();const q=B(n,o,C,2,c);K(n,q,o,.75)}n.fill(l);const h=B(n,o,i,2,c);K(n,h,o,.75)}function at(n,t,e,o,i,s){const l=B(n,o,i,5,s??0);K(n,l,o,0)}function j(n,t,e,o,i,s){const a=s??0,r=3;let c=f.collectibleStarCache.get(e);c===void 0&&(c=U(n,i,a,r),f.collectibleStarCache.set(e,c));const l=i.x*1.125;n.image(c,o.x-l,o.y-l)}function X(n,t,e,o,i){const s=[n.color(220,180,100,255),n.color(200,160,80,225),n.color(180,140,60,175),n.color(160,120,40,140)],a=[10,14,18,22];for(let r=0;r<s.length;r++)n.fill(s[r]),ht(n,g.height*.8+r*25-b,a[r],d.sandDuneOffsets[r])}function ct(n,t,e){n.push(),n.fill(235,71,71),n.stroke(255),n.strokeWeight(3),n.beginShape(),n.vertex(t.x,t.y),n.bezierVertex(t.x-e.x/2,t.y-e.x/2,t.x-e.x,t.y+e.x/4,t.x,t.y+e.x),n.bezierVertex(t.x+e.x,t.y+e.x/4,t.x+e.x/2,t.y-e.x/2,t.x,t.y),n.endShape(n.CLOSE),n.pop()}function lt(n,t,e,o,i){const s=f.palmTreeImg;if(s===null)throw new Error("Palm tree asset not loaded in time");if(n.angleMode(n.DEGREES),n.imageMode(n.CENTER),n.push(),n.translate(o.x,o.y),n.noStroke(),n.fill(62,149,199),n.ellipse(0,0,i.x,60),n.push(),n.translate(-i.x/2,-165),n.rotate(-8),n.image(s,0,0,300,300),n.pop(),n.push(),n.translate(i.x/2,-165),n.image(s,0,0,300,300),n.pop(),d.playerInOasis)if(n.textAlign(n.CENTER),n.textSize(P.Large),n.fill(255),d.playerScore>=N)n.image(f.fKeyImg,-110,-265,75,75),n.text("Press       to finish game",0,-250);else{const a=N-d.playerScore>1?"stars":"star";n.text(`You need ${N-d.playerScore} more ${a}!`,0,-250)}n.pop()}function U(n,t,e,o){const s=n.createGraphics(t.x*2.25,t.x*2.25);s.translate(t.x*(2.25/2),t.x*(2.25/2));const a=5,r=0,c=B(n,{x:0,y:0},t,a,e),l=dt(c,{x:0,y:0},r),u=s.drawingContext;u.save(),u.clip(l);const m=u.createConicGradient(0,0,0);n.colorMode(n.HSL);const h=[n.color(0,90,60).toString(),n.color(75,90,60).toString(),n.color(150,90,60).toString(),n.color(225,90,60).toString(),n.color(300,90,60).toString()];return m.addColorStop(0,h[0]),m.addColorStop(.2,h[1]),m.addColorStop(.4,h[2]),m.addColorStop(.6,h[3]),m.addColorStop(.8,h[4]),m.addColorStop(1,h[0]),u.fillStyle=m,u.fill(l),u.restore(),u.save(),u.lineWidth=o,u.strokeStyle="#FFFFFF",u.stroke(l),u.restore(),s}function K(n,t,e,o){n.beginShape(),n.vertex(t[0].x,t[0].y);for(let i=0;i<t.length;i++){const s=t[i],a=t[(i+1)%t.length],r=(s.x+a.x)/2,c=(s.y+a.y)/2,l=r+(e.x-r)*o,u=c+(e.y-c)*o;n.quadraticVertex(l,u,a.x,a.y)}n.endShape(n.CLOSE)}function dt(n,t,e){const o=new Path2D;o.moveTo(n[0].x,n[0].y);for(let i=0;i<n.length;i++){const s=n[i],a=n[(i+1)%n.length],r=(s.x+a.x)/2,c=(s.y+a.y)/2,l=r+(t.x-r)*e,u=c+(t.y-c)*e;o.quadraticCurveTo(l,u,a.x,a.y)}return o.closePath(),o}function B(n,t,e,o,i){n.push(),n.angleMode(n.RADIANS);const s=n.TAU/(2*o),a=[];for(let r=0;r<2*o;r++){const c=r%2===0?e.y:e.x,l=i+r*s,u=t.x+n.cos(l)*c,m=t.y+n.sin(l)*c;a.push({x:u,y:m})}return n.pop(),a}function ht(n,t,e,o){n.push(),n.angleMode(n.RADIANS),n.noStroke(),n.beginShape(),n.vertex(0,g.height);for(let i=0;i<=g.width;i+=20){const s=t+n.sin((i+o)*.01)*e;n.vertex(i,s)}n.vertex(g.width,g.height),n.endShape(n.CLOSE),n.pop()}function ut(n,t){return t*n**2+(1-t)*(1-(1-n)**3)}var $=(n=>(n[n.Load=0]="Load",n[n.Unload=1]="Unload",n))($||{});class yt{chunks=new Map;pendingOperations=[];addChunkData(t,e){let o=this.chunks.get(t);o===void 0&&(o={components:new Map,isActive:!1},this.chunks.set(t,o));for(const i of e){let s=o.components.get(i.entityId);s===void 0&&(s=[],o.components.set(i.entityId,s)),s.push(i)}}getChunkData(t){return this.chunks.get(t)}removeEntity(t,e){const o=this.chunks.get(t);o!==void 0&&o.components.delete(e)}isChunkActive(t){return this.chunks.get(t)?.isActive??!1}getActiveChunks(){return Array.from(this.chunks.entries()).filter(([t,e])=>e.isActive).map(([t,e])=>t)}unloadChunk(t,e){const o=this.chunks.get(e);if(o!==void 0&&o.isActive){for(const[i,s]of o.components)t.deactivateEntity(i);o.isActive=!1}}loadChunk(t,e){const o=this.chunks.get(e);if(o===void 0||o.isActive)return!1;for(const[i,s]of o.components){if(!t.activateEntity(i)&&!t.entityExists(i)){this.removeEntity(e,i);continue}for(const a of s)t.addComponent(a)}return o.isActive=!0,!0}queueChunkUnload(t){const e=this.chunks.get(t);e!==void 0&&e.isActive&&this.pendingOperations.push({chunkId:t,operation:1})}queueChunkLoad(t){const e=this.chunks.get(t);e!==void 0&&(e.isActive||this.pendingOperations.push({chunkId:t,operation:0}))}getPendingOperations(){return[...this.pendingOperations]}clearPendingOperations(){this.pendingOperations=[]}}function Q(){const n=W.currentChunk;return[n-1,n,n+1]}class Z{}class pt extends Z{generatedChunks=new Set;cactusCounter=0;cactusMinSpacing=150;generate(t,e,o){if(this.isGenerated(o))return;const i=this.generateCactusChunk(e,o),s=[];for(const a of i){const r=this.createCactusComponents(t,e,a.pos);s.push(...r)}e.chunkManager.addChunkData(o,s),this.markGenerated(o)}isGenerated(t){return this.generatedChunks.has(t)}markGenerated(t){this.generatedChunks.add(t)}generateCactusChunk(t,e){const o=[],i=e*O;let s=i+this.cactusMinSpacing;for(;!(s+50>i+O);)this.isOverlappingVoidZone(t,e,s,50)||o.push({pos:s,size:50}),s+=50+this.cactusMinSpacing;const a=Math.floor(Math.random()*2);for(let r=0;r<a;r++){const c=Math.floor(Math.random()*o.length);o.splice(c,1)}return o}createCactusComponents(t,e,o){this.cactusCounter++;const i={x:T.minWidth+Math.floor(Math.random()*(T.maxWidth-T.minWidth+1)),y:T.minHeight+Math.floor(Math.random()*(T.maxHeight-T.minHeight+1))},s=e.createEntity(`Cactus${this.cactusCounter}`);return[{entityId:s,type:"Cactus",parameters:G.generateParameters(i)},{entityId:s,type:"Position",position:{x:o,y:g.height-b-i.y}},{entityId:s,type:"Size",size:i},{entityId:s,type:"Render",fill:t.color(35,140,35),renderFn:G.render,zIndex:125,rotation:0}]}isOverlappingVoidZone(t,e,o,i){const s=t.chunkManager.getChunkData(e);if(s===void 0)return!1;const a=[];for(const[l,u]of s.components){if(!u.find(C=>C.type==="VoidZone"))continue;const m=C=>C.type==="Position",h=C=>C.type==="Size",y=u.find(m),p=u.find(h);if(y===void 0)throw new Error(`${t.getEntityDebugName(l)} missing PositionComponent for entity with id: ${l}`);if(p===void 0)throw new Error(`${t.getEntityDebugName(l)} missing SizeComponent for entity with id: ${l}`);a.push({pos:y.position,size:p.size})}if(a.length===0)return!1;const r=o,c=o+i;for(const{pos:l,size:u}of a){const m=l.x,h=l.x+u.x;if(r<h&&c>m)return!0}return!1}}class gt extends Z{generatedChunks=new Set;collectibleCounter=0;minCollectibles=3;maxCollectibles=7;outerSize=16;visualOuterSize=this.outerSize*2.25;yPos={min:400,max:g.height-b-this.outerSize*2.25};generate(t,e,o){if(this.isGenerated(o))return;const i=this.generateCollectibleChunk(o),s=[];for(const{x:a,y:r,isRare:c}of i){const l=this.createCollectibleComponents(t,e,{x:a,y:r},c);s.push(...l)}e.chunkManager.addChunkData(o,s),this.markGenerated(o)}isGenerated(t){return this.generatedChunks.has(t)}markGenerated(t){this.generatedChunks.add(t)}createCollectibleComponents(t,e,o,i){this.collectibleCounter++,t.push(),t.colorMode(t.HSL);const s=[t.color(25,80,60),t.color(120,55,55),t.color(180,50,50),t.color(230,75,60),t.color(260,65,65),t.color(310,60,65)],a=s[Math.floor(Math.random()*s.length)];t.pop();const r=e.reserveEntity(`Collectible${this.collectibleCounter}`);return[{entityId:r,type:"CollectibleTag"},{entityId:r,type:"Position",position:{x:o.x,y:o.y}},{entityId:r,type:"Size",size:{x:this.outerSize,y:9}},{entityId:r,type:"Collision",shape:R.Ellipse,collidingWith:new Set,size:{x:this.visualOuterSize,y:this.visualOuterSize}},{entityId:r,type:"Score",points:i?3:1},{entityId:r,type:"Render",zIndex:500,renderFn:i?j:at,fill:a,stroke:t.color(255),strokeWeight:3,rotation:Math.random()}]}generateCollectibleChunk(t){const e=this.minCollectibles+Math.floor(Math.random()*(this.maxCollectibles-this.minCollectibles)),o=new Array,i=t*O;for(let s=0;s<e;s++){const a=Math.random()*O+i,r=this.yPos.min+Math.random()*(this.yPos.max-this.yPos.min);if(!o.some(l=>this.isOverlapping({x:a,y:r},l))&&!this.isUnderSpawn(t,a)){const l=Math.random()>1-ot;o.push({x:a,y:r,isRare:l})}}return o}isOverlapping(t,e){const o=this.visualOuterSize,i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i**2+s**2)<o}isUnderSpawn(t,e){if(t!==0)return!1;const o=A-k.size/2,i=A+k.size/2,s=k.size*2.5;return e>=o-s&&e<=i+s}}class mt extends Z{generatedChunks=new Set;oasisChunk=V.chunk;generate(t,e,o){if(!this.shouldGenerate(o)||this.isGenerated(o))return;const i=this.generateOasis(o),s=this.createOasisComponents(e,i);e.chunkManager.addChunkData(o,s),this.markGenerated(o)}isGenerated(t){return this.generatedChunks.has(t)}markGenerated(t){this.generatedChunks.add(t)}shouldGenerate(t){return t===this.oasisChunk||t===-this.oasisChunk}generateOasis(t){const e=t*O,o=V.size/2+100;return e+o+Math.floor(Math.random()*(O-V.size))}createOasisComponents(t,e){const o=t.createEntity("Oasis");return[{entityId:o,type:"OasisTag"},{entityId:o,type:"Position",position:{x:e,y:g.height-b+25}},{entityId:o,type:"Size",size:{x:V.size,y:80}},{entityId:o,type:"Collision",collidingWith:new Set,shape:R.Ellipse,size:{x:V.size+20,y:1e3}},{entityId:o,type:"Render",zIndex:150,renderFn:lt}]}}class ft extends Z{generatedChunks=new Set;voidZoneCounter=0;voidZoneSize=[.4,1];voidZoneMinSpacing=1.5*k.size;generate(t,e,o){if(this.isGenerated(o))return;const i=this.generateVoidZoneChunk(t,e,o),s=[];for(const a of i){const r=this.createVoidZoneComponents(e,a.pos,a.size);s.push(...r)}e.chunkManager.addChunkData(o,s),this.markGenerated(o)}isGenerated(t){return this.generatedChunks.has(t)}markGenerated(t){this.generatedChunks.add(t)}createVoidZoneComponents(t,e,o){this.voidZoneCounter++;const i=t.reserveEntity(`VoidZone${this.voidZoneCounter}`);return[{entityId:i,type:"VoidZone",pattern:Math.floor(Math.random()*(D.patternCount-1))},{entityId:i,type:"Position",position:{x:e,y:g.height-b}},{entityId:i,type:"Size",size:{x:o,y:b}},{entityId:i,type:"Collision",collidingWith:new Set,shape:R.Rectangle},{entityId:i,type:"Render",zIndex:115,renderFn:H.render,rotation:0}]}generateVoidZoneChunk(t,e,o){const i=[],s=o*O;let a=s+this.voidZoneMinSpacing;for(;;){const c=Math.floor(t.random(...this.voidZoneSize)*275);if(a+c>s+O)break;!this.isUnderSpawn(o,a,c)&&!this.isUnderOasis(o,e,a,c)&&i.push({pos:a,size:c}),a+=c+this.voidZoneMinSpacing}const r=Math.floor(Math.random()*3);for(let c=0;c<r;c++){const l=Math.floor(Math.random()*i.length);i.splice(l,1)}return i}isUnderSpawn(t,e,o){if(t!==0)return!1;const i=A-k.size/2,s=A+k.size/2,a=e,r=e+o,c=k.size;return!(i>r+c||s<a-c)}isUnderOasis(t,e,o,i){if(t!==V.chunk&&t!==-8)return!1;const s=e.chunkManager.getChunkData(t);if(s===void 0)throw new Error("Chunk data was somehow undefined");const a=[];for(const[l,u]of s.components){if(!u.find(C=>C.type==="OasisTag"))continue;const m=C=>C.type==="Position",h=C=>C.type==="Size",y=u.find(m),p=u.find(h);if(y===void 0)throw new Error(`${e.getEntityDebugName(l)} missing PositionComponent for entity with id: ${l}`);if(p===void 0)throw new Error(`${e.getEntityDebugName(l)} missing SizeComponent for entity with id: ${l}`);a.push({pos:y.position,size:p.size})}if(a.length===0)return!1;const r=o,c=o+i;for(const{pos:l,size:u}of a){const m=l.x-u.x/2,h=l.x+u.x/2;if(r<h&&c>m)return!0}return!1}}class xt{constructor(t){this.p=t,this.world=new tt;const e=new It(t),o=[new mt,new ft,new gt,new pt];e.registerGenerators(...o),this.systems=[new St(t),e,new vt(t),new wt(t),new kt(t),new Pt(t),new Mt(t),new Rt(t),new Et(t),new zt(t),new bt(t),new Ft(t),new qt(t),new Lt(t),new Ot(t),new Gt(t),new Tt(t),new Vt(t),new At(t),new Bt(t)]}world;systems;update(){for(const t of this.systems)t.update(this.world);for(let t=0;t<d.playerLives;t++)ct(this.p,{x:40+t*50,y:30},{x:30});for(const t of f.voidZoneStarCache)for(const e of t)e.t+=.05}init(){this.initBackground(),this.initUi();const t=this.world.createEntity("Player");this.world.addComponent({entityId:t,type:"PlayerTag"}),this.world.addComponent({entityId:t,type:"Position",position:{x:A,y:Y}}),this.world.addComponent({entityId:t,type:"Velocity",velocity:{x:0,y:0}}),this.world.addComponent({entityId:t,type:"Size",size:{x:k.size,y:k.size}}),this.world.addComponent({entityId:t,type:"Physics",acceleration:k.acceleration,maxSpeed:k.maxSpeed,frictionForce:k.frictionForce,jumpForce:k.jumpForce,gravity:k.gravity,isGrounded:!1,isPlummeting:!1,hasControl:!0}),this.world.addComponent({entityId:t,type:"Collision",collidingWith:new Set,shape:R.Ellipse}),this.world.addComponent({entityId:t,type:"Render",shape:R.Ellipse,renderFn:M.render,zIndex:L.player,fill:this.p.color(255),stroke:this.p.color(0),strokeWeight:2});const e=this.world.createEntity("Camera");this.world.addComponent({entityId:e,type:"Camera",target:t}),this.world.addComponent({entityId:e,type:"Position",position:{x:0,y:0}});const o=this.world.createEntity("MainGround");this.world.addComponent({entityId:o,type:"MainGroundTag"}),this.world.addComponent({entityId:o,type:"GroundTag"}),this.world.addComponent({entityId:o,type:"Position",position:{x:0,y:g.height-b}}),this.world.addComponent({entityId:o,type:"Size",size:{x:g.width,y:b}}),this.world.addComponent({entityId:o,type:"Collision",collidingWith:new Set,shape:R.Rectangle}),this.world.addComponent({entityId:o,type:"Render",zIndex:L.ground,shape:R.Rectangle,fill:this.p.color(215,170,110)})}initBackground(){const t=this.world.createEntity("Background");this.world.addComponent({entityId:t,type:"Position",position:{x:0,y:0}}),this.world.addComponent({entityId:t,type:"Size",size:{x:g.width,y:g.height}}),this.world.addComponent({entityId:t,type:"Render",renderFn:J.render,rotation:0,zIndex:L.background});const e=this.world.createEntity("BigStar");this.world.addComponent({entityId:e,type:"BigStarTag"}),this.world.addComponent({entityId:e,type:"Position",position:{x:450,y:70}}),this.world.addComponent({entityId:e,type:"Size",size:{x:18,y:60}}),this.world.addComponent({entityId:e,type:"Render",renderFn:it,fill:this.p.color(250,222,180),rotation:1,zIndex:L.bigStar});const o=this.world.createEntity("BigStarRays");this.world.addComponent({entityId:o,type:"BigStarTag"}),this.world.addComponent({entityId:o,type:"Position",position:{x:450,y:70}}),this.world.addComponent({entityId:o,type:"Size",size:{x:18,y:60}}),this.world.addComponent({entityId:o,type:"Render",renderFn:st,fill:this.p.color(250,222,180),rotation:1,zIndex:L.bigStarRays});const i=6,s=[{x:180,y:40},{x:1200,y:120},{x:600,y:250},{x:140,y:325},{x:1050,y:400},{x:800,y:440}],a=[200,180,160,140,120,100];for(let c=0;c<i;c++){const l=this.world.createEntity(`Star${c+1}`);this.world.addComponent({entityId:l,type:"SmallStarTag"}),this.world.addComponent({entityId:l,type:"Position",position:{x:s[c].x,y:s[c].y}}),this.world.addComponent({entityId:l,type:"Size",size:{x:20,y:4}}),this.world.addComponent({entityId:l,type:"Render",fill:this.p.color(250,222,180),renderFn:rt,alpha:a[c],zIndex:L.smallStars,rotation:0})}const r=this.world.createEntity("SandDunes");this.world.addComponent({entityId:r,type:"Position",position:{x:0,y:0}}),this.world.addComponent({entityId:r,type:"Size",size:{x:20,y:4}}),this.world.addComponent({entityId:r,type:"Render",fill:this.p.color(250,222,180),renderFn:X,zIndex:L.sandDunes,rotation:0})}initUi(){const t=this.world.createEntity("ScoreIcon");this.world.addComponent({entityId:t,type:"Position",position:{x:43,y:110}}),this.world.addComponent({entityId:t,type:"Size",size:{x:16*1.3,y:9*1.3}}),this.world.addComponent({entityId:t,type:"Render",zIndex:L.scoreUI,renderFn:j,rotation:.32});const e=this.world.createEntity("ScoreText");this.world.addComponent({entityId:e,type:"Text",text:"",size:P.Large,updateFn:()=>`${d.playerScore}`}),this.world.addComponent({entityId:e,type:"Position",position:{x:80,y:125}}),this.world.addComponent({entityId:e,type:"Render",zIndex:L.scoreUI,fill:this.p.color(255)})}}class Ct{nextEntityId=0;entityStates=new Map;reserveId(){const t=this.nextEntityId++;return this.entityStates.set(t,!1),t}activateEntityId(t){return!this.entityStates.has(t)||this.entityStates.get(t)?!1:(this.entityStates.set(t,!0),!0)}deactivateEntityId(t){this.entityStates.has(t),this.entityStates.set(t,!1)}removeEntityId(t){this.entityStates.has(t)&&this.entityStates.delete(t)}isActive(t){return this.entityStates.get(t)===!0}isReserved(t){return this.entityStates.has(t)}getIds(){return Array.from(this.entityStates.keys())}}class tt{chunkManager;components=new Map;idManager=new Ct;entityMetadata=new Map;constructor(){this.chunkManager=new yt}createEntity(t){const e=this.idManager.reserveId();if(!this.idManager.activateEntityId(e))throw new Error(`Entity was already active, entity with id: ${e}`);return t&&this.entityMetadata.set(e,{name:t}),e}reserveEntity(t){const e=this.idManager.reserveId();return t&&this.entityMetadata.set(e,{name:t}),e}activateEntity(t){return this.idManager.activateEntityId(t)}deactivateEntity(t){this.idManager.isActive(t)&&this.idManager.deactivateEntityId(t)}removeEntity(t){if(this.idManager.isActive(t)){this.idManager.removeEntityId(t),this.entityMetadata.delete(t);for(const[e,o]of this.components)o.delete(t)}}entityExists(t){return this.idManager.getIds().includes(t)}requireSingle(t){const e=this.query(t);if(e.length===0)throw new Error(`Missing required ${t} component`);if(e.length>1)throw new Error(`Multiple ${t} components found`);return e[0]}addComponent(t){const e=t.type;this.components.has(e)||this.components.set(e,new Map),this.components.get(e)?.set(t.entityId,t)}getComponent(t,e){return this.components.get(e)?.get(t)}requireComponent(t,e){const o=this.getComponent(t,e);if(o===void 0)throw new Error(`Required component "${e}" not found on entity "${this.getEntityDebugInfo(t)}"`);return o}query(t){const e=this.components.get(t);return e?Array.from(e.values()):[]}queryEntities(...t){const e=[];for(const o of this.idManager.getIds())t.every(s=>this.components.get(s)?.has(o))&&e.push(o);return e}getEntityDebugName(t){return this.entityMetadata.get(t)?.name||"Unnamed Entity"}getEntityDebugInfo(t){const o=this.entityMetadata.get(t)?.name||`Entity-${t}`,i=Array.from(this.components.entries()).filter(([s,a])=>a.has(t)).map(([s])=>s).join(", ");return`${o} { ${i} }`}}class w{constructor(t){this.p=t}}class St extends w{update(t){const e=t.requireSingle("Camera"),o=t.requireComponent(e.entityId,"Position").position,i=t.requireComponent(e.target,"Velocity").velocity;o.x+=i.x}}class It extends w{generators=[];update(t){const e=Q();for(const o of e)for(const i of this.generators)i.isGenerated(o)||i.generate(this.p,t,o)}registerGenerators(...t){for(const e of t)this.generators.push(e)}}class vt extends w{update(t){const e=t.requireSingle("Camera"),o=t.requireComponent(e.entityId,"Position").position,i=this.p.floor(o.x/O);W.currentChunk!==i&&(W.currentChunk=i);const s=Q();for(const r of s)t.chunkManager.isChunkActive(r)||t.chunkManager.queueChunkLoad(r);const a=t.chunkManager.getActiveChunks();for(const r of a)s.includes(r)||t.chunkManager.queueChunkUnload(r)}}class wt extends w{update(t){const e=t.chunkManager.getPendingOperations();for(const o of e)o.operation===$.Unload&&t.chunkManager.unloadChunk(t,o.chunkId),o.operation===$.Load&&t.chunkManager.loadChunk(t,o.chunkId);t.chunkManager.clearPendingOperations()}}class kt extends w{update(t){const e=t.requireSingle("MainGroundTag"),o=t.requireSingle("PlayerTag"),i=t.requireComponent(e.entityId,"Position").position,s=t.requireComponent(o.entityId,"Velocity").velocity;i.x+=s.x}}class Pt extends w{update(t){const e=t.queryEntities("Position","Velocity");for(const o of e){const i=t.requireComponent(o,"Position").position,s=t.requireComponent(o,"Velocity").velocity;i.x+=s.x,i.y+=s.y}}}class Mt extends w{update(t){const e=t.query("Collision");for(const o of e)o.collidingWith.clear();for(let o=0;o<e.length-1;o++)for(let i=o+1;i<e.length;i++){const s=e[o],a=e[i],[r,c]=[t.requireComponent(s.entityId,"Position").position,t.requireComponent(a.entityId,"Position").position];let[l,u]=[t.requireComponent(s.entityId,"Size").size,t.requireComponent(a.entityId,"Size").size];s.size!==void 0&&(l=s.size),a.size!==void 0&&(u=a.size),this.checkCollision({pos:r,size:l,shape:s.shape},{pos:c,size:u,shape:a.shape})&&(s.collidingWith.add(a.entityId),a.collidingWith.add(s.entityId))}}checkCollision(t,e){return t.shape===R.Ellipse&&e.shape===R.Ellipse?this.ellipseWithEllipse(t,e):t.shape===R.Rectangle&&e.shape===R.Rectangle?this.rectWithRect(t,e):this.ellipseWithRect(t,e)||this.ellipseWithRect(e,t)}ellipseWithEllipse(t,e){const o=t.size.x/2,i=t.size.y/2,s=e.size.x/2,a=e.size.y/2,r=(t.pos.x-e.pos.x)/(o+s),c=(t.pos.y-e.pos.y)/(i+a);return r**2+c**2<1}rectWithRect(t,e){const o=t.pos.x+t.size.x,i=t.pos.y+t.size.y,s=e.pos.x+e.size.x,a=e.pos.y+e.size.y;return t.pos.x<s&&o>e.pos.x&&t.pos.y<a&&i>e.pos.y}ellipseWithRect(t,e){if(t.shape!==R.Ellipse||e.shape!==R.Rectangle)return!1;const o=t.size.x/2,i=t.size.y/2,s=(e.pos.x-t.pos.x)/o,a=(e.pos.y-t.pos.y)/i,r=(e.pos.x+e.size.x-t.pos.x)/o,c=(e.pos.y+e.size.y-t.pos.y)/i,l=this.p.min(s,r),u=this.p.max(s,r),m=this.p.min(a,c),h=this.p.max(a,c);if(0>=l&&0<=u&&0>=m&&0<=h)return!0;const y=Math.max(Math.min(0,u),l),p=Math.max(Math.min(0,h),m);return y**2+p**2<=1}}class Rt extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.requireComponent(e.entityId,"Position").position,i=t.requireComponent(e.entityId,"Size").size,s=t.requireComponent(e.entityId,"Physics");s.isPlummeting=!1;const a=i.x/2,r=i.y/2,c=o.x-a,l=o.x+a,u=o.y-r,m=o.y+r,h=t.query("VoidZone").find(y=>{const p=t.requireComponent(y.entityId,"Position").position,C=t.requireComponent(y.entityId,"Size").size,I=p.x+C.x;return c>=p.x&&l<=I});if(h!==void 0){const y=t.requireComponent(h.entityId,"Position").position,p=t.requireComponent(h.entityId,"Size").size;s.isPlummeting=!0;const C=y.y+p.y;u<C&&m>y.y&&(s.hasControl=!1,this.outOfBounds(t,e.entityId,h.entityId))}if(u>g.height+k.size*4){this.playerDeath(t,e.entityId);return}}outOfBounds(t,e,o){const i=t.requireComponent(e,"Velocity").velocity,s=t.requireComponent(e,"Position").position,a=t.requireComponent(e,"Size").size,r=t.requireComponent(o,"Position").position,c=t.requireComponent(o,"Size").size,l=s.x+i.x,u=a.x/2,m=l-u,h=l+u,y=r.x+c.x,p=m<=r.x,C=h>=y;p&&(i.x=0,s.x=r.x+u+1),C&&(i.x=0,s.x=y-u-1)}playerDeath(t,e){const o=t.requireSingle("Camera"),i=t.requireComponent(o.entityId,"Position").position,s=t.requireSingle("MainGroundTag"),a=t.requireComponent(s.entityId,"Position").position,r=t.requireComponent(e,"Position").position,c=t.requireComponent(e,"Velocity").velocity,l=t.requireComponent(e,"Physics");c.x=0,c.y=0,r.x=A,r.y=Y,i.x=0,a.x=0,l.isPlummeting=!1,l.isGrounded=!1,l.gravity=0,l.hasControl=!1,d.playerLives<=1?(x.gameOver.play(),x.gameOverMusic.loop(),et(E.GameOver),l.hasControl=!0,l.gravity=k.gravity):x.fall.play(),d.playerLives--}}class Et extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.requireComponent(e.entityId,"Physics");if(o.isPlummeting){o.isGrounded=!1;return}const i=t.query("GroundTag");for(const s of i)if(t.requireComponent(s.entityId,"Collision").collidingWith.has(e.entityId)){const r=t.requireComponent(e.entityId,"Position"),c=t.requireComponent(e.entityId,"Size"),l=t.requireComponent(e.entityId,"Velocity"),u=t.requireComponent(s.entityId,"Position"),m=c.size.y/2;r.position.y=u.position.y-m,o.isGrounded&&(l.velocity.y=0),o.isGrounded=!0}}}class zt extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.requireComponent(e.entityId,"Velocity").velocity,i=t.requireComponent(e.entityId,"Position").position,s=t.requireComponent(e.entityId,"Physics");!s.isGrounded&&d.playerJumpRotationProgress===0&&(Math.abs(o.x)>.25&&(o.y<0||i.y>=Y)?d.playerJumpRotationDirection=Math.sign(o.x):d.playerJumpRotationDirection=0),!s.isGrounded&&d.playerJumpRotationDirection!==0&&(d.playerJumpRotationProgress+=this.p.deltaTime/k.jumpRotationDuration,d.playerJumpRotationProgress>1&&(d.playerJumpRotationProgress=1)),s.isGrounded&&(d.playerJumpRotationProgress=0,d.playerJumpRotationDirection=0)}}class bt extends w{update(t){const e=t.requireSingle("PlayerTag").entityId,o=t.requireComponent(e,"Velocity").velocity,i=t.requireComponent(e,"Physics");i.gravity===0&&(this.isJumping()||this.isMovingLeft()||this.isMovingRight())&&(i.hasControl=!0,i.gravity=k.gravity),i.hasControl&&(this.isMovingLeft()&&(o.x-=i.acceleration),this.isMovingRight()&&(o.x+=i.acceleration),this.isJumping()&&i.isGrounded&&(x.jump.play(),o.y=i.jumpForce,i.isGrounded=!1),this.isMovingLeft()===this.isMovingRight()&&(o.x*=i.frictionForce,this.p.abs(o.x)<.1&&(o.x=0)))}isMovingLeft(){return d.pressedKeys.has("a")}isMovingRight(){return d.pressedKeys.has("d")}isJumping(){return d.pressedKeys.has(" ")||d.pressedKeys.has("w")}}class Ft extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.requireComponent(e.entityId,"Velocity").velocity,i=t.requireComponent(e.entityId,"Physics");o.y+=i.gravity,o.x=this.p.constrain(o.x,-i.maxSpeed,i.maxSpeed)}}class qt extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.query("OasisTag");for(const i of o)if(t.requireComponent(i.entityId,"Collision").collidingWith.has(e.entityId)){d.playerInOasis=!0;const a=d.playerScore>=N;this.finishButtonPressed()&&a&&et(E.GameFinished)}else d.playerInOasis=!1}finishButtonPressed(){return d.pressedKeys.has("f")}}class Lt extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.query("CollectibleTag");for(const i of o)if(t.requireComponent(i.entityId,"Collision").collidingWith.has(e.entityId)){const a=t.getComponent(i.entityId,"Score");if(a!==void 0)switch(d.playerScore+=a.points,a.points){case 1:x.pickupCollectible.play();break;case 3:x.pickupRareCollectible.play();break}t.removeEntity(i.entityId)}}}class Ot extends w{update(t){const e=t.query("Text").map(o=>o.entityId).filter(o=>t.getComponent(o,"Size")===void 0);for(const o of e){const i=t.requireComponent(o,"Text");this.p.push(),this.p.textSize(i.size);const s=this.p.textWidth(i.text);this.p.pop(),t.addComponent({entityId:o,type:"Size",size:{x:s,y:i.size}})}}}class Gt extends w{update(t){const e=t.query("Text");for(const o of e)o.updateFn!==void 0&&(o.text=o.updateFn())}}class Tt extends w{update(t){const e=t.requireSingle("PlayerTag"),o=t.requireComponent(e.entityId,"Velocity").velocity;for(let i=0;i<d.sandDuneOffsets.length;i++){const s=1+(i-1)/16;d.sandDuneOffsets[i]+=o.x*s}}}class Vt extends w{pulseSpeed=.015;rotationSpeed=1;update(t){this.p.push();const e=t.query("BigStarTag");for(const o of e){const i=t.requireComponent(o.entityId,"Render");if(i.rotation===void 0)throw new Error(`Entity: ${t.getEntityDebugName(i.entityId)} has undefined rotation.`);if(i.zIndex===L.bigStarRays){const s=(this.p.sin(d.starBgPulse)+1)*30;i.fill?.setAlpha(s),d.starBgPulse+=this.pulseSpeed}i.rotation-=this.p.deltaTime*(this.rotationSpeed/12500)}this.p.pop()}}class At extends w{pulseSpeed=.025;maxTwinkleChange=120;timeOffsets=new Map;update(t){const e=t.query("SmallStarTag");for(const o of e){const i=t.requireComponent(o.entityId,"Render");typeof i.baseAlpha>"u"&&(i.baseAlpha=i.alpha??255);const s=i.baseAlpha;let a=this.timeOffsets.get(o.entityId);typeof a>"u"&&(a=this.p.random(.25,this.p.TAU),this.timeOffsets.set(o.entityId,a));const c=this.p.sin(d.smallStarGlow+a)*(this.maxTwinkleChange/2),l=this.p.constrain(s+c,0,255);i.alpha=l}d.smallStarGlow+=this.pulseSpeed}}class Bt extends w{update(t){const e=t.requireSingle("Camera"),i=t.queryEntities("Render","Size","Position").map(s=>t.requireComponent(s,"Render")).sort((s,a)=>s.zIndex-a.zIndex);this.renderLayer(t,i.filter(s=>s.zIndex<100)),this.renderLayer(t,i.filter(s=>s.zIndex>=100&&s.zIndex<1e3),e),this.renderLayer(t,i.filter(s=>s.zIndex>=1e3))}renderLayer(t,e,o){if(this.p.push(),o){const a=t.requireComponent(o.entityId,"Position").position;this.p.translate(-a.x,-a.y)}const i=e.filter(a=>t.getComponent(a.entityId,"Text")===void 0),s=e.filter(a=>t.getComponent(a.entityId,"Text"));for(const a of i){const r=t.requireComponent(a.entityId,"Size"),c=t.requireComponent(a.entityId,"Position");this.p.push(),this.p.noStroke(),this.p.noFill(),this.applyStyles(a),this.drawGame(t,c,r,a),this.p.pop()}for(const a of s){const r=t.requireComponent(a.entityId,"Text"),c=t.requireComponent(a.entityId,"Position");this.p.push(),this.applyStyles(a),this.drawText(c,r),this.p.pop()}this.p.pop()}applyStyles(t){t.fill&&(t.alpha!==void 0&&t.fill.setAlpha(t.alpha),this.p.fill(t.fill)),t.stroke&&this.p.stroke(t.stroke),t.strokeWeight&&this.p.strokeWeight(t.strokeWeight)}drawText(t,e){this.p.textSize(e.size),this.p.text(e.text,t.position.x,t.position.y)}drawGame(t,e,o,i){if(i.shape===void 0&&i.renderFn===void 0)throw new Error(`Entity: ${t.getEntityDebugName(i.entityId)}, with RenderComponent has no shape or renderFn`);if(i.renderFn!==void 0){i.renderFn(this.p,t,e.entityId,e.position,o.size,i.rotation);return}switch(i.shape){case R.Ellipse:this.p.ellipse(e.position.x,e.position.y,o.size.x,o.size.y);break;case R.Rectangle:this.p.rect(e.position.x,e.position.y,o.size.x,o.size.y);break}}}const W={generatedChunks:new Set,currentChunk:0},d={game:null,gameState:E.GameStart,pressedKeys:new Set,playerLives:3,playerScore:0,playerInOasis:!1,playerJumpRotationProgress:0,playerJumpRotationDirection:0,starBgPulse:0,smallStarGlow:0,sandDuneOffsets:[-165,180,-50,100],shouldCaptureFrame:!1,shouldDrawHelp:!1,hKeyProcessed:!1},f={cactusCache:new Map,cactusFlowerCache:new Map,collectibleStarCache:new Map,voidZoneStarCache:new Array,voidZoneStarBuffers:new Array,backgroundBuffer:{},gameHelpOverlayBuffer:null,gameStateOverlayBuffer:null,palmTreeImg:{},spaceKeyImg:{},aKeyImg:{},wKeyImg:{},dKeyImg:{},rKeyImg:{},fKeyImg:{},hKeyImg:{},lastFrame:null},v={thin:{},thinItalic:{},extraLightItalic:{},extraLight:{},lightItalic:{},light:{},regular:{},italic:{},medium:{},mediumItalic:{},semiBold:{},semiBoldItalic:{},bold:{},boldItalic:{},extraBold:{},extraBoldItalic:{},black:{},blackItalic:{}},x={music:{},musicLow:{},musicLowest:{},jump:{},pickupCollectible:{},pickupRareCollectible:{},fall:{},gameOver:{},gameOverMusic:{},victory:{},victoryMusic:{}};function _(n){W.generatedChunks=new Set,W.currentChunk=0,d.pressedKeys=new Set,d.playerLives=3,d.playerScore=0,d.playerInOasis=!1,d.playerJumpRotationProgress=0,d.playerJumpRotationDirection=0,d.starBgPulse=0,d.smallStarGlow=0,d.sandDuneOffsets=[-165,180,-50,100],d.shouldCaptureFrame=!1,d.shouldDrawHelp=!1,d.hKeyProcessed=!1,f.cactusCache=new Map,f.gameStateOverlayBuffer=null,f.gameHelpOverlayBuffer=null,f.lastFrame=null;for(const t of Object.values(x))t.initState();n.textFont(v.regular),n.colorMode(n.RGB),d.game=new xt(n),d.game.init()}function et(n){d.gameState===E.GameLoop&&(d.shouldCaptureFrame=!0),d.gameState=n}p5.disableFriendlyErrors=!0;const Dt=n=>{n.preload=()=>{l(),u(),m(),J.preload(n),G.preloadFlowerCache(n),H.preloadStars(n)},n.setup=()=>{n.createCanvas(g.width,g.height),n.getAudioContext().suspend(),_(n)},n.draw=()=>{switch(n.clear(),d.gameState!==E.GameLoop&&(x.music.stop(),x.musicLow.stop(),x.musicLowest.stop()),d.gameState){case E.GameStart:t();break;case E.GameLoop:e();break;case E.GameOver:o();break;case E.GameFinished:i()}const h=d.gameState===E.GameStart||d.gameState===E.GameLoop;d.shouldDrawHelp&&h&&c()},n.keyPressed=()=>{d.pressedKeys.add(n.key),n.userStartAudio(),n.key==="h"&&!d.hKeyProcessed&&(d.shouldDrawHelp=!d.shouldDrawHelp,d.hKeyProcessed=!0)},n.keyReleased=()=>{d.pressedKeys.delete(n.key),n.key==="h"&&(d.hKeyProcessed=!1)};function t(){if(d.pressedKeys.has(" ")){d.pressedKeys.delete(" "),d.gameState=E.GameLoop;return}const h=new tt;n.image(f.backgroundBuffer,0,0),X(n,h,h.createEntity());for(let y=0;y<d.sandDuneOffsets.length;y++){const p=1+(y-1)/16;d.sandDuneOffsets[y]+=1.25*p}if(n.fill(215,170,110),n.noStroke(),n.rect(0,g.height-b,g.width,b),!d.shouldDrawHelp){n.push(),n.imageMode(n.CENTER);const y=-40,p=55;n.textFont(v.bold),s("Press       to start",P.Huge,n.CENTER,{x:g.width/2,y:g.height/2+P.Huge/2+y}),n.image(f.spaceKeyImg,g.width/2-34,g.height/2+15+y,104,104),n.textFont(v.regular),s("Press       for help",P.Large,n.CENTER,{x:g.width/2,y:g.height/2+P.Large/2+p}),n.image(f.hKeyImg,g.width/2-28,g.height/2+8+p,80,80),n.pop()}}function e(){switch(d.playerLives){case 3:x.music.isLooping()||x.music.loop();break;case 2:x.music.stop(),x.musicLow.isLooping()||x.musicLow.loop();break;case 1:x.musicLow.stop(),x.musicLowest.isLooping()||x.musicLowest.loop();break}if(d.game===null)throw new Error("Game was null");d.game.update(),d.shouldCaptureFrame&&(f.lastFrame=n.get(),d.shouldCaptureFrame=!1)}function o(){if(d.pressedKeys.has("r")){_(n),d.gameState=E.GameLoop;return}a();const h=5,y=U(n,{x:16*h,y:9*h},.32,8),p=96,C=50,I={x:g.width/2-C-15*d.playerScore.toString().length,y:g.height/2+75};n.push(),n.imageMode(n.CENTER);const S={x:g.width/2,y:g.height/2+P.Massive/2};n.textFont(v.bold),s("Game Over!",P.Massive,n.CENTER,{x:S.x,y:S.y-50}),s(d.playerScore.toString(),P.Massive,n.LEFT,{x:S.x-C/8*d.playerScore.toString().length,y:S.y+60}),n.image(y,I.x,I.y,p,p),n.textFont(v.regular),s("Press       to play again",P.Large,n.CENTER,{x:S.x,y:S.y+250}),n.image(f.rKeyImg,g.width/2-95,g.height-75,80,80),n.pop()}function i(){if(d.pressedKeys.has("r")){_(n),d.gameState=E.GameLoop;return}a(),x.victory.hasPlayed()||x.victory.play(),x.victoryMusic.isLooping()||x.victoryMusic.loop();const h=5,y=U(n,{x:16*h,y:9*h},.32,8),p=96,C=50,I={x:g.width/2-C-15*d.playerScore.toString().length,y:g.height/2+75};n.push(),n.imageMode(n.CENTER);const S={x:g.width/2,y:g.height/2+P.Massive/2};n.textFont(v.bold),s("Victory!",P.Massive,n.CENTER,{x:S.x,y:S.y-50}),s(d.playerScore.toString(),P.Massive,n.LEFT,{x:S.x-C/8*d.playerScore.toString().length,y:S.y+60}),n.image(y,I.x,I.y,p,p),n.textFont(v.regular),s("Press       to play again",P.Large,n.CENTER,{x:S.x,y:S.y+250}),n.image(f.rKeyImg,g.width/2-95,g.height-75,80,80),n.pop()}function s(h,y,p,C={x:g.width/2,y:g.height/2+y/2}){n.push(),n.fill(255,255,255,255),n.textAlign(p),n.textSize(y),n.text(h,C.x,C.y),n.pop()}function a(){n.push(),r();const h=f.gameStateOverlayBuffer;if(h===null)throw new Error("gameStateOverlay was null");n.image(h,0,0),n.pop()}function r(){if(f.gameStateOverlayBuffer!==null)return;const h=f.lastFrame;if(h===null)throw new Error("lastFrame was null");const y=n.createGraphics(g.width,g.height);n.push(),y.image(h,0,0),y.filter(n.BLUR,8),y.fill(0,0,0,nt),y.rect(0,0,g.width,g.height),n.pop(),f.gameStateOverlayBuffer=y}function c(){const h=g.width/3,y=g.height/2.75,p=1.5,C=P.Large*p,I=[{text:"Move Left",img:[f.aKeyImg]},{text:"Move Right",img:[f.dKeyImg]},{text:"Jump",img:[f.wKeyImg,f.spaceKeyImg]},{text:"Toggle Help",img:[f.hKeyImg]}];if(n.noStroke(),n.fill(0,0,0,120),n.rect(h-35,y-75,500,65*I.length+50*p,10),f.gameHelpOverlayBuffer!==null){n.image(f.gameHelpOverlayBuffer,0,0);return}const S=n.createGraphics(g.width,g.height);S.textFont(v.light),S.textSize(P.Large),S.imageMode(n.CENTER);const q=80;S.fill(255);for(let z=0;z<I.length;z++)S.text(I[z].text,h,y+z*C),S.image(I[z].img[0],h+325,y+z*C-15,q,q),I[z].img.length>1&&S.image(I[z].img[1],h+325+70,y+z*C-15,q,q);f.gameHelpOverlayBuffer=S}function l(){n.soundFormats("ogg"),n.outputVolume(.5),x.music=new F(n,"../sound/mainLoop.ogg"),x.musicLow=new F(n,"../sound/mainLoopLow.ogg"),x.musicLowest=new F(n,"../sound/mainLoopLowest.ogg"),x.gameOverMusic=new F(n,"../sound/gameOverLoop.ogg"),x.victoryMusic=new F(n,"../sound/victoryLoop.ogg"),x.jump=new F(n,"../sound/jump.ogg"),x.pickupCollectible=new F(n,"../sound/collectible.ogg"),x.pickupRareCollectible=new F(n,"../sound/rareCollectible.ogg"),x.fall=new F(n,"../sound/fall.ogg"),x.gameOver=new F(n,"../sound/gameOver.ogg"),x.victory=new F(n,"../sound/victory.ogg"),x.music.setVolume(.25),x.musicLow.setVolume(.25),x.musicLowest.setVolume(.25),x.victoryMusic.setVolume(.25),x.gameOverMusic.setVolume(.25),x.jump.setVolume(.2),x.pickupCollectible.setVolume(.5),x.fall.setVolume(.5),x.gameOver.setVolume(.5),x.victory.setVolume(.8)}function u(){v.thin=n.loadFont("../Poppins/Poppins-Thin.ttf"),v.thinItalic=n.loadFont("../Poppins/Poppins-ThinItalic.ttf"),v.extraLight=n.loadFont("../Poppins/Poppins-ExtraLight.ttf"),v.extraLightItalic=n.loadFont("../Poppins/Poppins-ExtraLightItalic.ttf"),v.light=n.loadFont("../Poppins/Poppins-Light.ttf"),v.lightItalic=n.loadFont("../Poppins/Poppins-LightItalic.ttf"),v.regular=n.loadFont("../Poppins/Poppins-Regular.ttf"),v.italic=n.loadFont("../Poppins/Poppins-Italic.ttf"),v.medium=n.loadFont("../Poppins/Poppins-Medium.ttf"),v.mediumItalic=n.loadFont("../Poppins/Poppins-MediumItalic.ttf"),v.semiBold=n.loadFont("../Poppins/Poppins-SemiBold.ttf"),v.semiBoldItalic=n.loadFont("../Poppins/Poppins-SemiBoldItalic.ttf"),v.bold=n.loadFont("../Poppins/Poppins-Bold.ttf"),v.boldItalic=n.loadFont("../Poppins/Poppins-BoldItalic.ttf"),v.extraBold=n.loadFont("../Poppins/Poppins-ExtraBold.ttf"),v.extraBoldItalic=n.loadFont("../Poppins/Poppins-ExtraBoldItalic.ttf"),v.black=n.loadFont("../Poppins/Poppins-Black.ttf"),v.blackItalic=n.loadFont("../Poppins/Poppins-BlackItalic.ttf")}function m(){f.aKeyImg=n.loadImage("../image/keyboard_a.png"),f.wKeyImg=n.loadImage("../image/keyboard_w.png"),f.dKeyImg=n.loadImage("../image/keyboard_d.png"),f.rKeyImg=n.loadImage("../image/keyboard_r.png"),f.fKeyImg=n.loadImage("../image/keyboard_f.png"),f.hKeyImg=n.loadImage("../image/keyboard_h.png"),f.spaceKeyImg=n.loadImage("../image/keyboard_space_icon.png"),f.palmTreeImg=n.loadImage("../image/palmtree.png")}};new p5(Dt);
